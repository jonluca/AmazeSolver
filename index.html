<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Amaze!</title>
</head>
<body>
<!--Code adapted from http://jsfiddle.net/n8j1s/4y22135r/-->
<canvas id="GameBoardCanvas" width="400px" height="400px">
</canvas>
</body>
<script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script>
  const canvas = $('#GameBoardCanvas');
  //The game board 1 = walls, 0 = free space, and -1 = the goal
  const board = [
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1], [1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1],
    [1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1], [1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0],
    [1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0], [1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0],
    [-1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0]
  ];
  const player = {
    x: 0,
    y: 0
  };

  //Draw the game board
  function draw() {
    const width = canvas.width();
    const blockSize = width / board.length;
    const ctx = canvas[0].getContext('2d');
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, width, width);
    ctx.fillStyle = "black";
    //Loop through the board array drawing the walls and the goal
    for (let y = 0; y < board.length; y++) {
      for (let x = 0; x < board[y].length; x++) {
        //Draw a wall
        if (board[y][x] === 0) {
          ctx.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
        }
      }
    }
    //Draw the player
    ctx.beginPath();

    ctx.fillStyle = "#b598f1";
    //Loop through the board array drawing the walls and the goal
    for (let y = 0; y < board.length; y++) {
      for (let x = 0; x < board[y].length; x++) {
        //Draw a wall
        if (board[y][x] === 2) {
          ctx.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
        }
      }
    }
    //Draw the player
    ctx.beginPath();
    const half = blockSize / 2;
    ctx.fillStyle = "blue";
    ctx.arc(player.x * blockSize + half, player.y * blockSize + half, half, 0, 2 * Math.PI);
    ctx.fill();
  }

  //Check to see if the new space is inside the board and not a wall
  function canMove(x, y) {
    return (y >= 0) && (y < board.length) && (x >= 0) && (x < board[y].length) && (board[y][x] !== 0);
  }

  function moveInDirection(x, y) {
    player.x += x;
    player.y += y;
    board[player.y][player.x] = 2;
    if (canMove(player.x + x, player.y + y)) {
      setTimeout(() => {
        moveInDirection(x, y);
        draw();
      }, 10);
    } else {
      checkWinState();
    }
  }

  function checkWinState() {
    for (let y = 0; y < board.length; y++) {
      for (let x = 0; x < board[y].length; x++) {
        //Draw a wall
        if (board[y][x] === 1) {
          return;
        }
      }
    }

    alert("win!");
  }

  $(document).keydown(function (e) {
    if ((e.which === 38) && canMove(player.x, player.y - 1)) { //Up arrow
      moveInDirection(0, -1);
    } else if ((e.which === 40) && canMove(player.x, player.y + 1)) { // down arrow
      moveInDirection(0, 1);
    } else if ((e.which === 37) && canMove(player.x - 1, player.y)) {//left arrow
      moveInDirection(-1, 0);
    } else if ((e.which === 39) && canMove(player.x + 1, player.y)) {//right arrow
      moveInDirection(1, 0);
    }
    board[player.y][player.x] = 2;
    draw();
  });

  draw();
</script>
</html>
